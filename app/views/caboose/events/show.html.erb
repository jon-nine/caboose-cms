<%
bt = Caboose::BlockType.where(:description => 'Caboose Calendar').first
b1 = Caboose::Block.where(:block_type_id => bt.id).where(:page_id => Caboose::Page.where(:site_id => @event.calendar.site_id).pluq(:id)).first if bt && @event.calendar
b2 = b1.child('calendars_to_show') if b1
bl = Caboose::Block.where(:id => b2.id).where("value ILIKE ? OR value = ?","%#{@event.calendar_id}%","all").first if b2
pg = bl.parent.page if bl && bl.parent
%>

<div class="post-details-wrapper event">
	<div class="constrain">
		<div class="main-post-content event">
			<% if @event.image && !@event.image.url.blank? && !@event.image.url.include?('placehold') %>
				<img src="<%= @event.image.url(:large) %>" alt="<%= @event.name %>" width="300" style="display:block;margin:0 0 20px 0;" />
			<% end %>
			<div class="post-text">
				<h2 class="post-title"><%= @event.name %></h2>
				<% if !@event.location.blank? %><h4 class="location"><%= @event.location %></h4><% end %>
				<% if !@event.begin_date.blank? && !@event.end_date.blank? %>
				<% bd = @event.begin_date #.in_time_zone("Central Time (US & Canada)") %>
				<% ed = @event.end_date #.in_time_zone("Central Time (US & Canada)") %>
				<% if @event.all_day %>
					<% if bd.strftime("%B") == ed.strftime("%B") && bd.strftime("%Y") == ed.strftime("%Y") && bd.strftime("%d") == ed.strftime("%d") %>
					<p class="begin-date"><%= bd.strftime("%B %-d, %Y") %></p>
					<% else %>
					<p class="begin-date">Begins: <%= bd.strftime("%B %-d, %Y") %></p>
					<p class="end-date">Ends: <%= ed.strftime("%B %-d, %Y") %></p>
					<% end %>
				<% else %>
					<p class="begin-date">Begins: <%= bd.strftime("%B %-d, %Y at %l:%M%P") %></p>
					<p class="end-date">Ends: <%= ed.strftime("%B %-d, %Y at %l:%M%P") %></p>
				<% end %>
				<% end %>
				<div class='share-icons clearfix' style="margin-top:20px;">
					<div class="share-buttons">
						<% url = "http://" + @site.primary_domain.domain + '/calendar-events/' + @event.id.to_s %>
						<a href="https://www.facebook.com/sharer/sharer.php?u=<%= url %>" target="_blank" title="Share on Facebook" class="holder" id="facebook" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><span class="icon-facebook white"></span></a>
						<a href="https://twitter.com/home?status=<%= @event.name + ' @ ' + url %>" title="Share on Twitter" target="_blank" class="holder" id="twitter" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><span class="icon-twitter white"></span></a>
						<a href="https://plus.google.com/share?url=<%= url %>" title="Share on Google +" target="_blank" class="holder" id="google-plus" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><span class="icon-google-plus white"></span></a>
						<a href="mailto:?subject=<%= @event.name %>&amp;body=<%= url %>" title="Share by Email" class="holder" id="email"><span class="icon-mail white"></span></a>
					</div>
        </div>
				<div class="post-body richtext" style="margin-bottom:30px;">
					<div class="content_body">
						<%== @event.description %>
			    </div>
				</div>
				<% if !@event.url.blank? %>
					<a <% if @event.url.include?('http') %>target="_blank"<% end %> href="<%= @event.url %>" style="margin-right:15px;" class="btn"><%= @event.url_label.blank? ? "More Info" : @event.url_label %></a>
				<% end %>
				<% if pg %>
					<a href="/<%= pg.uri %>" class="btn">Back to Calendar</a>
				<% end %>
			</div>
		</div>
	</div>
</div>

<% content_for :caboose_css do %>
<style>
	.begin-date, .end-date {
		font-weight: bold;
		margin-bottom: 5px;
	}
	.post-details-wrapper.event {
		max-width: 1000px;
    margin: 0 auto;
    padding: 30px 2% 50px 2%;
	}
</style>
<% end %>