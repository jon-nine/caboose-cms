<%
# app/views/caboose/pages/admin_edit_content.html.erb
%>

<% content_for :caboose_css do %>
<%= stylesheet_link_tag 'jquery-ui' %>
<%= stylesheet_link_tag 'caboose/admin_block_edit_image' %>
<%= stylesheet_link_tag 'caboose/admin_edit_page_content' %>
<%= stylesheet_link_tag "caboose/modal_inline" %>
<% end %>

<% content_for :caboose_js do %>
<%= javascript_include_tag 'jquery-ui' %>
<%= javascript_include_tag 'caboose/model/all' %>
<%= javascript_include_tag 'caboose/jquery-ui.drag-multiple.min.js' %>
<%= javascript_include_tag "caboose/clipboard" %>
<%= javascript_include_tag 'caboose/block_content_controller' %>
<%= javascript_include_tag "caboose/class" %>
<%= javascript_include_tag "caboose/modal_controller" %>
<%= javascript_include_tag "caboose/block_modal_controllers/block_modal_controller" %>
<script type='text/javascript'>

var controller = false;
$(document).ready(function() {
  controller = new BlockContentController({
    page_id: <%= @page.id %>,
    assets_path: <%= raw Caboose.json(asset_path('loading.gif').gsub('loading.gif', '')) %>,
    included_assets: ['caboose/block_modal_controllers/block_modal_controller.js']
  });

  $('body').append($('<div/>')        
    .attr('id', 'tiny_header')
    .append($('<a/>').attr('href', '/admin/pages').html("< Back"))
    .append($('<a/>').attr('href', '#').html('Page Options').click(function(e) { e.preventDefault(); caboose_modal_url('/admin/pages/<%= @page.id %>/custom-fields'); }))
    .append($('<a/>').attr('href', '/admin/pages/<%= @page.id %>/layout').html("Layout"))
    .append($('<a/>').attr('href', '/admin/pages/<%= @page.id %>').html("Settings"))    
  );

  var html = "<%== (render :partial => 'caboose/pages/new_block_header').gsub( / *\n+/, '' ) %> ";
  $('body').append($('<div/>')
    .attr('id', 'block_sidebar')
    .append(html)
  );
  $("#new_blocks li span").draggable({ revert: true, scroll: false });

});

</script>
<% end %>
